"use strict";(self.webpackChunkfinal3=self.webpackChunkfinal3||[]).push([[206],{6206:(e,a,s)=>{s.r(a),s.d(a,{default:()=>j});var t=s(5043),c=s(8839),l=s(5081),n=s.n(l),r=s(1929),o=s.n(r),d=s(9889),i=s.n(d),m=s(7580),h=s(831),u=s(9005),x=s(3002),b=s(1462),p=s(7962),N=s(579);const j=()=>{const[e,a]=(0,t.useState)([]),[s,l]=(0,t.useState)(""),[r,d]=(0,t.useState)([]),[j,f]=(0,t.useState)([]),[g,k]=(0,t.useState)([]),[y,v]=(0,t.useState)(""),[C,w]=(0,t.useState)(""),[S,L]=(0,t.useState)([]),[E,F]=(0,t.useState)(""),I=(0,t.useRef)(),A=(0,t.useRef)(),B=(0,t.useRef)(),M=(0,t.useRef)(),T=(0,t.useRef)(),R=(0,t.useRef)(),G=(0,t.useRef)(null),[H,_]=(0,t.useState)(!1),[q,D]=(0,t.useState)(!1),[O,Q]=(0,t.useState)(!1),[z,J]=(0,t.useState)(!1),[K,P]=(0,t.useState)(!1),[V,X]=(0,t.useState)(""),[U,W]=(0,t.useState)([]),Y=(e,a)=>e.split(new RegExp("(".concat(a,")"),"gi")).map(((e,s)=>e.toLowerCase()===a.toLowerCase()?(0,N.jsx)("span",{className:"highlight",children:e},s):e)),[Z,$]=(0,t.useState)(!1),[ee,ae]=(0,t.useState)(""),[se,te]=(0,t.useState)([]),[ce,le]=(0,t.useState)(""),[ne,re]=(0,t.useState)([]),[oe,de]=(0,t.useState)(!1),[ie,me]=(0,h.L4)(u.g3),[he,ue]=(0,t.useState)(1),[xe]=(0,t.useState)(40),[be,pe]=(0,t.useState)(!1),Ne=(0,t.useRef)(!1),je=(0,t.useRef)(null);(0,t.useEffect)((()=>{je.current&&je.current.scrollIntoView()}),[g]),(0,t.useEffect)((()=>{fe()}),[]);const fe=(0,t.useCallback)((async()=>{const e=await m.A.get("/chat/list");if(e.data){const s=await Promise.all(e.data.map((async e=>{try{const a=await m.A.get("/chat/recentMessageList/".concat(e.chatroomNo)),s=a.data.length>0?a.data[0].messageContent:"",t=a.data.length>0?a.data[0].messageTimeMinute:"";return{...e,recentMessage:s,recentMessageTime:t}}catch(a){return{...e,recentMessage:"",recentMessageTime:""}}})));a(s)}}),[]),ge=(0,t.useCallback)((async()=>{const e=await m.A.get("/emp/list");d(e.data)}),[]),ke=(0,t.useCallback)((async()=>{const e=await m.A.get("/emp/");f([e.data])}),[]);(0,t.useEffect)((()=>{ge(),ke()}),[]),(0,t.useEffect)((()=>{ye()}),[s]);const ye=(0,t.useCallback)((async()=>{if(!s)return;const e=await m.A.get("/chat/chatroomEmpList/".concat(s));L(e.data)}),[s]),ve=(0,t.useCallback)((()=>{ge();new c.aF(B.current).show()}),[ge,B]),Ce=(0,t.useCallback)((()=>{c.aF.getInstance(B.current).hide()}),[B]);(0,t.useEffect)((()=>{we()}),[]);const we=(0,t.useCallback)((async e=>{if(!s)return;const a=await m.A.post("/chat/inviteEmp/".concat(s,"/").concat(e));if(a.data){const e=a.data.chatroomNo;Be(),Ce(),fe(),setTimeout((()=>{l(e),He(e)}),300)}}),[s]),Se=(0,t.useCallback)((async()=>{const e={chatroomNo:s,chatroomName:E};200===(await m.A.patch("/chat/",e)).status&&(a((e=>e.map((e=>e.chatroomNo===s?{...e,chatroomName:E}:e)))),w(E),Ee())}),[s,E]),Le=(0,t.useCallback)((a=>{if(!a)return;const s=e.find((e=>e.chatroomNo===a));s&&F(s.chatroomName);new c.aF(T.current).show()}),[T,e]),Ee=(0,t.useCallback)((()=>{c.aF.getInstance(T.current).hide()}),[T]),Fe=(0,t.useCallback)((async()=>{try{if(!s)return;const e=I.current.querySelector(".modal-body"),a=e.scrollHeight,t=await m.A.get("/chat/".concat(s,"/page/").concat(he,"/size/").concat(xe));k((e=>[...t.data.list,...e])),pe(t.data.last),0===g.length||t.data.list.length===g.length?setTimeout((()=>{R.current.scrollTop=R.current.scrollHeight}),200):setTimeout((()=>{const s=e.scrollHeight;e.scrollTop=s-a}),10)}catch(e){console.error("\uc5d0\ub7ec\uc784",e)}}),[s,he,xe]),Ie=(0,t.useRef)(null);(0,t.useEffect)((()=>{if(s){return(()=>{Ie.current&&Ie.current.close();const e=new(n())("http://192.168.30.6:8080/ws/emp");e.onopen=()=>{Ie.current=e},e.onmessage=e=>{const a=JSON.parse(e.data);k((e=>[...e,a])),fe()},Fe()})(),()=>{Ie.current&&Ie.current.close()}}}),[s,Fe]);const Ae=()=>{if(!y.trim()||!Ie.current)return;const e={token:m.A.defaults.headers.common.Authorization,messageContent:y.trim(),chatroomNo:s},a=JSON.stringify(e);Ie.current.send(a),v(""),G.current&&(G.current.style.height="65px"),fe()},Be=(0,t.useCallback)((()=>{if(I.current){const e=c.aF.getInstance(I.current);e&&e.hide()}if(l(""),k([]),_(!1),J(!1),v(""),le(""),de(!1),B.current){const e=c.aF.getInstance(B.current);e&&e.hide()}}),[]),Me=(0,t.useCallback)(i()((()=>{if(!Ne.current&&!be){const e=I.current.querySelector(".modal-body");if(e){0!==e.scrollTop||be||ue((e=>e+1))}}}),300),[be]),Te=(0,t.useCallback)((()=>{if(M.current){const e=c.aF.getInstance(M.current);e&&e.hide()}}),[M]),Re=(0,t.useCallback)((async e=>{if(e)try{200===(await m.A.delete("/chat/outChatroom/".concat(e))).status&&(a((a=>a.filter((a=>a.chatroomNo!==e)))),Te(),Be(),ye(),fe())}catch(s){s.response&&404===s.response.status?(a((a=>a.filter((a=>a.chatroomNo!==e)))),Te(),Be(),ye(),fe()):console.error("Error leaving chatroom:",s)}}),[a,Te,Be,ye,fe]),Ge=(0,t.useCallback)((e=>{if(e&&M.current){new c.aF(M.current).show()}}),[M]),He=(0,t.useCallback)((a=>{if(I.current){const s=new c.aF(I.current);l(a);const t=e.find((e=>e.chatroomNo===a));t&&(w(t.chatroomName),s.show(),ue(1),Fe())}}),[I,e,Fe]);(0,t.useEffect)((()=>{const e=I.current?I.current.querySelector(".modal-body"):null;if(e){e.addEventListener("scroll",Me);const a=e=>{try{"Escape"===e.key&&(Be(),Ee(),Te())}catch(a){console.error("Error handling Escape key press:",a)}};return document.addEventListener("keydown",a),()=>{e.removeEventListener("scroll",Me),document.removeEventListener("keydown",a)}}}),[I,Be,Ee,Te,Fe,Me]),(0,t.useEffect)((()=>{const e=I.current.querySelector(".modal-body");if(e)return e.addEventListener("scroll",Me),()=>{e.removeEventListener("scroll",Me)}}),[Me]);const _e=(0,t.useCallback)((e=>{const a=r.find((a=>a.empNo===e));f(a?[a]:[]);new c.aF(A.current).show()}),[r,A]),qe=(0,t.useCallback)((()=>{c.aF.getInstance(A.current).hide()}),[A]);return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)("div",{className:"row mt-4",children:[(0,N.jsx)("div",{className:"col-md-6 chat-goods",children:(0,N.jsxs)("table",{className:"table",children:[(0,N.jsx)("thead",{className:"text-center",children:(0,N.jsx)("tr",{children:(0,N.jsxs)("th",{children:["\ub0b4 \ucc44\ud305\ubc29",(0,N.jsx)("span",{className:"magnifyingGlass ms-2 clickable",onClick:()=>{P((e=>!e)),X(""),W([])},children:(0,N.jsx)(p.xQi,{})})]})})}),(0,N.jsx)("div",{className:"chatroom-search-wrapper ".concat(K?"show":""),children:K&&(0,N.jsx)("input",{type:"text",className:"form-control mt-2",placeholder:"\ucc44\ud305\ubc29 \uc774\ub984 \uac80\uc0c9",value:V,onChange:a=>{const s=a.target.value;if(X(s),""!==s.trim()){const a=e.filter((e=>e.chatroomName.toLowerCase().includes(s.toLowerCase())));W(a)}else W([])}})}),(0,N.jsx)("tbody",{className:"chat-tbody",children:(U.length>0?U:e).map((e=>(0,N.jsx)(t.Fragment,{children:(0,N.jsx)("tr",{onClick:()=>He(e.chatroomNo),children:(0,N.jsxs)("td",{children:[(0,N.jsxs)("span",{className:"chatroom-name",children:[V?Y(e.chatroomName,V):e.chatroomName," ",(0,N.jsx)("br",{})]}),(0,N.jsx)("span",{className:"last-message mt-2",children:e.recentMessage||""}),(0,N.jsx)("span",{className:"last-message-time",children:e.recentMessageTime||""})]})})},e.chatroomNo)))})]})}),(0,N.jsx)("div",{className:"col-md-6 table-emp chat-goods",children:(0,N.jsxs)("table",{className:"table",children:[(0,N.jsx)("thead",{className:"text-center",children:(0,N.jsx)("tr",{children:(0,N.jsxs)("th",{children:["\uc6b0\ub9ac\ud68c\uc0ac \uc0ac\uc6d0 \u2665",(0,N.jsx)("span",{className:"magnifyingGlass ms-2 clickable",onClick:()=>{$((e=>!e)),ae(""),te([])},children:(0,N.jsx)(p.xQi,{})})]})})}),(0,N.jsx)("div",{className:"emp-search-wrapper ".concat(Z?"show":""),children:Z&&(0,N.jsx)("input",{type:"text",className:"form-control mt-2",placeholder:"\uc0ac\uc6d0 \uc774\ub984 \uac80\uc0c9",value:ee,onChange:e=>{const a=e.target.value;if(ae(a),""!==a.trim()){const e=r.filter((e=>e.empName.toLowerCase().includes(a.toLowerCase())));te(e)}else te([])}})}),(0,N.jsx)("tbody",{className:"text-center chat-tbody",children:(se.length>0?se:r).map((e=>(0,N.jsx)("tr",{onClick:()=>_e(e.empNo),children:(0,N.jsxs)("td",{children:[ee?Y(e.empName,ee):e.empName," (",e.empGrade,")"]})},e.empNo)))})]})})]}),(0,N.jsx)("div",{ref:I,className:"modal fade",id:"chatModal","data-bs-backdrop":"static",tabIndex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",children:(0,N.jsx)(o(),{cancel:".form-control, .chat-container",children:(0,N.jsx)("div",{className:"modal-dialog modal-dialog-scrollable",children:(0,N.jsxs)("div",{className:"modal-content",children:[(0,N.jsxs)("div",{className:"modal-header",children:[(0,N.jsxs)("div",{className:"col-3",children:[(0,N.jsx)("button",{className:"btn btn-secondary clickable",onClick:()=>{_((e=>!e))},children:"\ucc38\uc5ec\uc790"}),(0,N.jsxs)("ul",{className:"participants-sidebar ".concat(H?"expanded":""),children:[S.map((e=>(0,N.jsxs)("div",{className:"participant-list",children:[e.empName," (",e.empGrade,")"]},e.empNo))),(0,N.jsx)("button",{className:"mt-2 btn btn-secondary",onClick:()=>ve(s),children:"\uc0ac\uc6d0\ucd08\ub300"})]})]}),(0,N.jsx)("p",{className:"modal-title chatroom-name",id:"staticBackdropLabel",children:C}),(0,N.jsx)("p",{className:"modal-title gear clickable",onClick:()=>{J((e=>!e))},children:(0,N.jsx)(x.Xpn,{})}),(0,N.jsxs)("ul",{className:"manageChatroom-sidebar ".concat(z?"expanded":""),children:[C,(0,N.jsx)("br",{}),(0,N.jsx)("button",{className:"mt-2 btn btn-secondary",onClick:()=>Le(s),children:"\ucc44\ud305\ubc29\uc774\ub984\uc218\uc815"}),(0,N.jsx)("button",{className:"mt-2 btn btn-danger",onClick:()=>Ge(s),children:"\ucc44\ud305\ubc29\ub098\uac00\uae30"})]}),(0,N.jsx)("button",{type:"button",className:"btn-close",onClick:Be})]}),(0,N.jsx)("div",{className:"modal-body",ref:R,children:(0,N.jsxs)("div",{className:"chat-container",children:[g.map((e=>(0,N.jsxs)("div",{className:"chat-bubble ".concat(e.messageSender===ie?"mine":"others"),children:[e.messageSender!==ie&&(0,N.jsxs)("div",{className:"sender-info",children:[e.messageSenderName," (",e.messageSenderGrade,")"]}),(0,N.jsx)("div",{className:"message-content",children:(0,N.jsx)("div",{dangerouslySetInnerHTML:{__html:e.messageContent.replace(/\n/g,"<br />")}})}),(0,N.jsx)("div",{className:"message-time",children:e.messageTimeMinute})]},e.messageNo))),(0,N.jsx)("div",{className:"last-area",ref:je})]})}),(0,N.jsxs)("div",{className:"modal-footer",children:[(0,N.jsx)("textarea",{className:"form-control",placeholder:"\uba54\uc138\uc9c0\ub97c \uc785\ub825\ud558\uc138\uc694.",ref:G,value:y,onChange:e=>{v(e.target.value),e.target.style.height="65px",e.target.style.height="".concat(e.target.scrollHeight,"px")},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Ae())}}),(0,N.jsx)("button",{className:"btn btn-pink",onClick:Ae,children:(0,N.jsx)(b.B07,{})})]})]})})})}),(0,N.jsx)("div",{ref:A,className:"modal fade",id:"staticBackdrop",tabIndex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",children:(0,N.jsx)("div",{className:"modal-dialog modal-dialog-scrollable",children:(0,N.jsxs)("div",{className:"modal-content",children:[(0,N.jsxs)("div",{className:"modal-header",children:[(0,N.jsx)("h1",{className:"modal-title fs-5",id:"staticBackdropLabel",children:"\uc0ac\uc6d0\uc815\ubcf4"}),(0,N.jsx)("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:qe})]}),(0,N.jsx)("div",{className:"modal-body",children:(0,N.jsx)("table",{className:"table text-center",children:(0,N.jsx)("tbody",{className:"",children:j.map((e=>(0,N.jsxs)(t.Fragment,{children:[(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{children:"\uc0ac\uc6d0\uba85"}),(0,N.jsx)("td",{children:e.empName})]}),(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{children:"\uc0ac\uc6d0\ubc88\ud638"}),(0,N.jsx)("td",{children:e.empNo})]}),(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{children:"\uc18c\uc18d\ubd80\uc11c"}),(0,N.jsx)("td",{children:e.empDept})]}),(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{children:"\uc5f0\ub77d\ucc98"}),(0,N.jsx)("td",{children:e.empContact})]}),(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{children:"\uc774\uba54\uc77c"}),(0,N.jsx)("td",{children:e.empEmail})]}),(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{children:"\uc790\uae30\uc18c\uac1c"}),(0,N.jsx)("td",{children:e.empPr})]})]},e.empNo)))})})}),(0,N.jsx)("div",{className:"modal-footer",children:j.map((e=>e.empNo!==ie&&(0,N.jsx)("button",{className:"btn btn-pink",onClick:()=>(async e=>{const a=await m.A.post("chat/findOrCreate/".concat(e));a.data&&(qe(),He(a.data.chatroomNo),fe())})(e.empNo),children:"\ucc44\ud305\ud558\uae30"},e.empNo)))})]})})}),(0,N.jsx)("div",{ref:B,id:"empListModal",className:"modal fade",tabIndex:"-1",children:(0,N.jsx)("div",{className:"modal-dialog modal-dialog-scrollable",children:(0,N.jsxs)("div",{className:"modal-content",children:[(0,N.jsxs)("div",{className:"modal-header",children:[(0,N.jsx)("h5",{className:"modal-title",children:"\u2606\uc0ac\uc6d0 \ucd08\ub300\u2606"}),(0,N.jsx)("span",{className:"magnifyingGlass ms-2 clickable",onClick:()=>{de((e=>!e)),le(""),re([])},children:(0,N.jsx)(p.xQi,{})}),(0,N.jsx)("button",{type:"button",className:"btn-close",onClick:e=>Ce()})]}),(0,N.jsx)("div",{className:"invite-search-wrapper ".concat(oe?"show":""),children:oe&&(0,N.jsx)("input",{type:"text",className:"form-control mt-2",placeholder:"\uc0ac\uc6d0 \uc774\ub984 \uac80\uc0c9",value:ce,onChange:e=>{const a=e.target.value;if(le(a),""!==a.trim()){const e=r.filter((e=>e.empName.toLowerCase().includes(a.toLowerCase())));re(e)}else re([])}})}),(0,N.jsx)("div",{className:"modal-body",children:(0,N.jsx)("table",{className:"table",children:(0,N.jsx)("tbody",{children:(ne.length>0?ne:r).filter((e=>!S.some((a=>a.empNo===e.empNo)))).map((e=>(0,N.jsx)("tr",{children:(0,N.jsxs)("td",{onClick:()=>we(e.empNo),children:[ce?Y(e.empName,ce):e.empName," (",e.empGrade,")"]})},e.empNo)))})})})]})})}),(0,N.jsx)("div",{ref:T,className:"modal fade",id:"staticBackdrop","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",children:(0,N.jsx)("div",{className:"modal-dialog",children:(0,N.jsxs)("div",{className:"modal-content",children:[(0,N.jsxs)("div",{className:"modal-header",children:[(0,N.jsx)("h1",{className:"modal-title fs-5",id:"staticBackdropLabel",children:"\u2661\ucc44\ud305\ubc29 \uc774\ub984 \ubcc0\uacbd ^___^\u2661"}),(0,N.jsx)("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:e=>Ee()})]}),(0,N.jsx)("div",{className:"modal-body",children:(0,N.jsx)("div",{className:"form-group",children:(0,N.jsx)("input",{type:"text",className:"form-control",id:"newChatroomName",placeholder:"\ubcc0\uacbd\ud560 \ucc44\ud305\ubc29 \uc774\ub984\uc744 \uc785\ub825\ud558\uc138\uc694.",value:E,onChange:e=>F(e.target.value)})})}),(0,N.jsxs)("div",{className:"modal-footer",children:[(0,N.jsx)("button",{type:"button",className:"btn btn-pink",onClick:Se,children:"\uc774\ub984 \ubcc0\uacbd"}),(0,N.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:Ee,children:"\ub2eb\uae30"})]})]})})}),(0,N.jsx)("div",{ref:M,className:"modal fade",id:"staticBackdrop","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",children:(0,N.jsx)("div",{className:"modal-dialog",children:(0,N.jsxs)("div",{className:"modal-content",children:[(0,N.jsxs)("div",{className:"modal-header",children:[(0,N.jsx)("h1",{className:"modal-title fs-5",id:"staticBackdropLabel",children:"\u3139\u3147 \ub098\uac00\uc2e4\uac74\uac00\uc694 ..? .."}),(0,N.jsx)("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:e=>Te()})]}),(0,N.jsx)("div",{className:"modal-body",children:"\ub098\uac00\uae30\ubc84\ud2bc \ub20c\ub800\uc744\ub54c \ub098\uc624\ub294\uac70"}),(0,N.jsxs)("div",{className:"modal-footer",children:[(0,N.jsx)("button",{type:"button",className:"btn btn-danger",onClick:()=>Re(s),children:"\ub098\uac00\uae30"}),(0,N.jsx)("button",{type:"button",className:"btn btn-pink",onClick:Te,children:"\uc548\ub098\uac00\uae30"})]})]})})})]})}}}]);
//# sourceMappingURL=206.da29d362.chunk.js.map